<div class="wrapper">
  <div class="d-flex flex-dr flex-gap-8 p-12 top-note custom-font" [ngClass]="{'submit-note':evidence?.isSubmitted}">
    <mat-icon >
      info
    </mat-icon>
    <div>{{ !evidence?.isSubmitted ? "Survey ends on "+ (endTime | date): "Your response has already been submitted." }}</div>
  </div>

  <form [formGroup]="questionnaireForm" class="main">
    <div class="custom-font" *ngFor="let section of sections; let sectionIndex = index">
      <lib-main #mainComponent [questions]="section.questions" [questionnaireForm]="questionnaireForm"
        [fileUploadResponse]="fileuploadresponse" [isSubmitted]="evidence?.isSubmitted"
        [fileSizeLimit]="fileSizeLimit"></lib-main>
    </div>
  </form>
  <hr class="partition" />
  <div
    
    class="m-16 d-flex flex-ai-center flex-jc-space-around flex-dr flex-gap-30"
  >
    <button class="btn btn-outline-secondary" (click)="submission('draft')" >
      Save
    </button>

      <mat-icon (click)="getQuestionMap()" matTooltip="Question Map" style="height: auto;width: auto;color: var(--primary-color);font-size: 40px;">map</mat-icon>

    <button class="btn btn-primary" (click)="!questionnaireForm?.valid ? getQuestionMap() : submission('submit')">
      Submit
    </button>
  </div>
</div>

<ng-template #questionMapModal>
  <div style="padding: 0 4px;">
    <div mat-dialog-title class="d-flex flex-dr flex-ai-center flex-gap-3 flex-jc-flex-start p-10"
      style="color: var(--primary-color)">
      Question Map
    </div>
    <mat-divider></mat-divider>
    <div mat-dialog-content class="qmap">
      <div class="d-flex flex-dr flex-w-wrap flex-gap-8" style="margin-bottom: 8px;">
        <span style="color: #080808;"><span style="color: #A30000;font-size: 48px;vertical-align: bottom;">&#x2022;</span> Required & unanswered</span>
        <span style="color: #080808;"><span style="color:#006600;font-size: 48px;vertical-align: bottom;">&#x2022;</span> Answered</span>
        <span style="color: #080808;"><span style="color: #595959;font-size: 48px;vertical-align: bottom;">&#x2022;</span> Optional & unanswered</span>
      </div>
      <div *ngFor="let page of questionMap | sortKeys" style="padding: 4px;">
        <ng-container *ngIf="questionMap[page].length">
          <div class="d-flex" style="color: #080808;">
            <div><mat-icon style="vertical-align: middle;">arrow_right</mat-icon></div>
            <div class="d-flex flex-dc">
              {{page}}
              <div class="d-flex flex-dr flex-gap-8 flex-w-wrap" style="margin: 12px 0;">
                <ng-container *ngFor="let question of questionMap[page]">
                  <button (click)="goToQuestion(question._id,question.pageIndex)" mat-mini-fab [ngStyle]="{
                  'background-color':question.validity
                }">
                    {{ question.questionNumber }}
                  </button>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
    <div mat-dialog-actions class="d-flex flex-jc-space-around">
      <button class="btn btn-primary" type="button" (click)="closeModal()">
        Close
      </button>
    </div>
  </div>
</ng-template>